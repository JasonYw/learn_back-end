<!DOCTYPE html>
    <head lang="en">
        <meta charset="utf-8">
        <title>classes</title>
        <script src="/static/jquery.js"></script>
        <link rel="stylesheet" href="/static/plugin/bootstrap-3.3.7-dist/css/bootstrap.css">
        <link rel="stylesheet" href="/static/plugin/font-awesome-4.7.0/css/font-awesome.css">
        <link rel="stylesheet" href="/static/class.css">
    </head>
    <body>
        <div style="width: 700px; margin: 0 auto;">
            <h1>classes</h1>
            <div style="margin-bottom: 10px;">
                <a href="/add_class/" class="btn btn-info glyphicon glyphicon-plus"></a>
                <button onclick="showModal()" class="btn btn-info glyphicon glyphicon-plus"></button>
            </div>
            <table class="table table-striped table-bordered table-hover ">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>class</th>
                        <th>operate</th>
                        <th style="display: none;">operate_</th>
                    </tr>
                </thead>
                <tbody>
                    {% for class in class_list %}
                        <tr>
                            <td>{{class.0}}</td>
                            <td>{{class.1}}</td>
                            <td>
                                <a href="/del_class/?nid={{class.0}}" class="btn btn-danger glyphicon glyphicon-trash"></a>
                                
                                <a href="/edit_class/?nid={{class.0}}" class="btn btn-warning glyphicon glyphicon-pencil"></a>
                            </td>
                            <td style="display: none;">
                                <button value="{{class.0}}" class="btn btn-danger glyphicon glyphicon-trash" onclick="AjaxDelete(this);"></button>
                                <button value="{{class.0}}" class="btn btn-warning glyphicon glyphicon-pencil" onclick="AjaxEdit(this);"></button>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
            <a href="/" class="fa fa-mail-reply-all"></a>
        </div>
    </body>
    <!-- 表单提交无法完成不刷新页面提交 -->
    <!-- <div id="shadow" class="shadow hide"></div>
    <div id="modal" class="modal hide">
        <form action="/modal_add_class/" method="POST">
            <P>
                <input type="text" name="title">
            </P>
            <input type="submit" value="提交">
        </form>
    </div> -->
    <div id="shadow" class="shadow hide"></div>
    <div id="modal" class="modal hide">
        <p style="margin-left: 10px;">添加班级名称：<input id ="title" type="text" name="title"></p>
        <input type="submit" value="提交" onclick="AjaxSend();" style="margin-left: 10px;"><span id="error"></span>
        <input type="button" value="cancle" name="add_class" onclick="cancleModal(this);">
    </div>
    <div id="shadow-edit" class="shadow hide"></div>
    <div id="modal-edit" class="modal hide">
        <span style="margin-left: 10px;">class id:<span id="s_c_id"></span></span>
        class name:<span id="s_c_name"></span></br>
        <span style="margin-left: 10px;">新的班级名称：<input type="text" name="title" id="class_input" ></span></br>
        <span style="margin-left: 10px;"><input type="button" value="submit" onclick="edit_send();"></span>
        <input type="button" value="cancle" name="edit_class"onclick="cancleModal(this);">
    </div>
    <script>
        function showModal(){
            document.getElementById('shadow').classList.remove('hide')
            document.getElementById('modal').classList.remove('hide')
        }
        function cancleModal(obj){
            if (obj.getAttribute("name") == "add_class"){
                document.getElementById('shadow').classList.add('hide')
                document.getElementById('modal').classList.add('hide')
            }else{
                document.getElementById("shadow-edit").classList.add('hide')
                document.getElementById('modal-edit').classList.add('hide')
            }
        }
        function AjaxSend(){
            $.ajax({
                url:'/modal_add_class/',
                type:'POST',
                data:{
                    'title':$('#title').val()
                },
                success:function(data){
                    //当服务端处理完成后，返回数据时，该函数自动调用
                    //data代表服务端返回的值
                    //服务器先拿到值
                    if (data =="ok"){
                        location.href='/class/';
                    }else{
                        $('#error').text(data);
                    }

                }
            })
        }
        function AjaxDelete(obj){
            var class_id =obj.getAttribute("value")
            $.ajax({
                url:'/modal_del_class/',
                type:'POST',
                data:{
                    'class_id':class_id
                },
                success:function(data){
                    if (data =='200'){
                        location.href ='/class/'
                    }else{
                        alert('error delete class id :'+class_id)
                    }
                }
            })
        }
        function AjaxEdit(obj){
            var class_id =obj.getAttribute("value")
            $.ajax({
                url:'/modal_edit_class/',
                type:'GET',
                data:{
                    'nid':class_id
                },
                success:function(data){
                    if (data !=''){
                        document.getElementById('shadow-edit').classList.remove('hide')
                        document.getElementById('modal-edit').classList.remove('hide')
                        $('#s_c_id').text(class_id)
                        $('#s_c_name').text(data)
                    }else{
                        alert('error edit id of class:'+class_id)
                    }

                }
            })
        }
        function edit_send(){
            var class_id =$('#s_c_id').text();
            var new_classname =$('#class_input').val();
            $.ajax({
                url:'/modal_edit_class/',
                type:'POST',
                data:{
                    'class_id':class_id,
                    'new_c_name':new_classname,
                },
                success:function(data){
                    if(data != 'ERROR'){
                        location.href ='/class/'
                    }else{
                        alert('error edit for class:'+class_id)
                    }
                }
            })
        }
    </script>
</html>